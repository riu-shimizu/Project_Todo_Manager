# ğŸŒ± ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†ï¼†Todoçµ±åˆã‚¢ãƒ—ãƒª åˆå¿ƒè€…å‘ã‘èª¬æ˜

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€**å°ã•ã‚ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é€²æ—ç®¡ç†ã¨ Todo ç®¡ç†ã‚’ä¸€ä½“åŒ–**ã—ãŸ Web ã‚¢ãƒ—ãƒªã§ã™ã€‚  
ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ§‹é€ ï¼ˆå¤§ãƒ»ä¸­ãƒ»å°é …ç›®ï¼‰ã€ã¨ã€Œå®Ÿéš›ã«ã‚„ã‚‹ä½œæ¥­ï¼ˆTodoï¼‰ã€ã‚’ã¾ã¨ã‚ã¦ç®¡ç†ã§ãã¾ã™ã€‚

> ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ **ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¶…åˆå¿ƒè€…å‘ã‘** ã«æ›¸ã„ã¦ã„ã¾ã™ã€‚  
> ã€ŒReact ã£ã¦ãªã«ï¼Ÿã€ã€Œã‚µãƒ¼ãƒãƒ¼ã£ã¦ãªã«ï¼Ÿã€ãã‚‰ã„ã®ãƒ¬ãƒ™ãƒ«ã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

---

## 0. ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®èª­ã¿æ–¹ï¼ˆãŠã™ã™ã‚ã®é †ç•ªï¼‰

ä¸Šã‹ã‚‰é †ç•ªã«å…¨éƒ¨èª­ã¾ãªãã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚ã¾ãšã¯æ¬¡ã®é †ç•ªã§çœºã‚ã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚

1. **1. ã©ã‚“ãªã‚¢ãƒ—ãƒªã‹**  
   â†’ ã‚¢ãƒ—ãƒªã®ã‚´ãƒ¼ãƒ«ã¨éšå±¤æ§‹é€ ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ã¤ã‹ã‚€
2. **2. ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã®è¦‹æ–¹** + **3. ä½¿ã£ã¦ã„ã‚‹æŠ€è¡“ã®æ¦‚è¦**  
   â†’ ã€Œã©ã“ã«ä½•ãŒã‚ã‚‹ã‹ã€ã‚’ã–ã£ãã‚ŠæŠŠæ¡ã™ã‚‹
3. **5. å‡¦ç†ã®æµã‚Œï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ï¼‰**  
   â†’ ç”»é¢æ“ä½œã¨ API å‘¼ã³å‡ºã—ã®é–¢ä¿‚ã‚’çŸ¥ã‚‹
4. **4. å‡¦ç†ã®æµã‚Œï¼ˆã‚µãƒ¼ãƒãƒ¼å´ï¼‰**  
   â†’ ãƒ•ãƒ­ãƒ³ãƒˆã‹ã‚‰æ¥ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚µãƒ¼ãƒãƒ¼ã§ã©ã†å‡¦ç†ã•ã‚Œã‚‹ã‹ã‚’çœºã‚ã‚‹
5. **11. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã€œé€²æ—åæ˜ ã¾ã§ã‚’ã‚³ãƒ¼ãƒ‰ã§è¿½ã†**  
   â†’ ã€Œ1 ã¤ã®æ“ä½œãŒã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é€šã‚‹ã‹ã€ã‚’ã€å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã§ç¢ºèªã™ã‚‹
6. ä½™è£•ãŒã‚ã‚Œã° **13. è¶…ã–ã£ãã‚Š API / DB / React å…¥é–€** ã‚’èª­ã‚“ã§ã€ç”¨èªã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å›ºã‚ã‚‹

å›°ã£ãŸã¨ãã¯ã€8 ç« ã€Œã©ã“ã‹ã‚‰èª­ã‚ã°ã„ã„ã‹ï¼ˆå­¦ç¿’ã®é †ç•ªï¼‰ã€ã‚‚å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚

---

## 1. ã©ã‚“ãªã‚¢ãƒ—ãƒªã‹ï¼ˆã–ã£ãã‚Šã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰

- Web ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã **ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚¢ãƒ—ãƒª**
- 4 éšå±¤ã§ã‚¿ã‚¹ã‚¯ã‚’ç®¡ç†ã—ã¾ã™
  - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ
    - å¤§é …ç›®ï¼ˆPhaseï¼‰
      - ä¸­é …ç›®ï¼ˆWorkï¼‰
        - å°é …ç›®ï¼ˆTaskï¼‰
          - Todoï¼ˆå®Ÿéš›ã®ä½œæ¥­ï¼‰
- å„ãƒ¬ãƒ™ãƒ«ã§ã€Œäºˆå®šæ—¥ãƒ»å®Ÿç¸¾æ—¥ãƒ»é€²æ—ã€ã€Œãƒ¡ãƒ¢ã€ãªã©ã‚’ç®¡ç†ã§ãã¾ã™
- Todo ã§ã¯
  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆæœªç€æ‰‹ / é€²è¡Œä¸­ / å®Œäº†ï¼‰
  - æ‹…å½“è€…
  - æœŸé™
  ã‚’ç®¡ç†ã—ã¾ã™
- Todo ã®å®Œäº†çŠ¶æ³ã‹ã‚‰ã€Task â†’ Work â†’ Phase â†’ Project ã® **é€²æ—ç‡ã‚’è‡ªå‹•ã§è¨ˆç®—**ã—ã¾ã™

---

## 2. ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã®è¦‹æ–¹

ãƒªãƒã‚¸ãƒˆãƒªç›´ä¸‹ã¯ã“ã‚“ãªæ§‹æˆã§ã™ï¼š

- `server/` â€¦ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ï¼‰
- `web/` â€¦ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶å´ï¼‰
- `è¦ä»¶å®šç¾©æ›¸.md` â€¦ ä½•ãŒã§ãã‚‹ã‚¢ãƒ—ãƒªã‹ã€æ©Ÿèƒ½ã®è©³ç´°èª¬æ˜
- `ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä»•æ§˜æ›¸.md` â€¦ ã‚‚ã†å°‘ã—æŠ€è¡“å¯„ã‚Šã®æ§‹é€ èª¬æ˜

### 2.1 server ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰

`server/src` ã®ä¸­èº«ï¼š

- `domain/`
  - `entities.ts` â€¦ Phase / Work / Task / Todo ãªã©ã®ã€Œãƒ‡ãƒ¼ã‚¿ã®å½¢ï¼ˆå‹ï¼‰ã€ã‚’å®šç¾©
  - `progress.ts` â€¦ é€²æ—ç‡ã‚’è¨ˆç®—ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯
- `application/`
  - `projectService.ts` â€¦ ã‚¢ãƒ—ãƒªã®ã€Œãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã€ã®ä¸­å¿ƒã€‚  
    ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’å‡ºã™ã€ã€Œéšå±¤ã‚’çµ„ã¿ç«‹ã¦ã‚‹ã€ã€Œé€²æ—ã‚’è¨ˆç®—ã™ã‚‹ã€ãªã©ã‚’ã¾ã¨ã‚ã¦ã„ã‚‹ã€‚
- `infrastructure/`
  - `db.ts` â€¦ SQLiteï¼ˆ`app.db`ï¼‰ã¸ã®æ¥ç¶šã‚’æ‰±ã†
  - `migrations.ts` â€¦ ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‹å‡¦ç†
  - `seed.ts` â€¦ ãƒ‡ãƒ¢ç”¨ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹å‡¦ç†
  - `repositories/` â€¦ DB ã«å¯¾ã™ã‚‹ CRUD ã‚’æ‹…å½“
    - `projectRepository.ts`
    - `hierarchyRepository.ts`
    - `userRepository.ts`
- `presentation/`
  - `server.ts` â€¦ Express ã§ HTTP API ã‚’å®šç¾©ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

### 2.2 web ãƒ•ã‚©ãƒ«ãƒ€ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰

`web/src` ã®ä¸­èº«ï¼š

- `App.tsx` â€¦ ãƒ•ãƒ­ãƒ³ãƒˆå´ã®ã€Œãƒ¡ã‚¤ãƒ³å‡¦ç†ã€ã€‚ãƒšãƒ¼ã‚¸å…¨ä½“ã®çŠ¶æ…‹ã‚’ç®¡ç†ã€‚
- `api.ts` â€¦ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® API ã‚’å‘¼ã³å‡ºã™é–¢æ•°ã®ä¸€è¦§ã€‚
- `components/`
  - `HierarchyView.tsx` â€¦ éšå±¤ï¼ˆPhase/Work/Task/Todoï¼‰ã®ãƒ¡ã‚¤ãƒ³ç”»é¢
  - `ProjectSidebar.tsx` â€¦ å·¦å´ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
  - `TodayPanel.tsx` â€¦ å³å´ã®ã€Œä»Šæ—¥ã‚„ã‚‹ Todo ãƒªã‚¹ãƒˆã€
  - ãã®ä»–ã€å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ãªã©ã®å°ã•ã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

---

## 3. ä½¿ã£ã¦ã„ã‚‹æŠ€è¡“ã®æ¦‚è¦ï¼ˆã–ã£ãã‚Šï¼‰

é›£ã—ã„ç”¨èªã¯ã€**ã‚¤ãƒ¡ãƒ¼ã‚¸ã ã‘æ´ã‚ã‚Œã° OK** ã§ã™ã€‚

- **TypeScript**
  - JavaScript ã«ã€Œå‹ã€ã®ä»•çµ„ã¿ã‚’è¶³ã—ãŸè¨€èª
  - ã€Œã“ã®å¤‰æ•°ã¯æ–‡å­—åˆ—ã€ã€Œã“ã®é–¢æ•°ã¯æ•°å€¤ã‚’è¿”ã™ã€ãªã©ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨ã§ã€ãƒŸã‚¹ã‚’æ¸›ã‚‰ã™
- **React + Vite**
  - React â€¦ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã® UI ã‚’ä½œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
  - Vite â€¦ é–‹ç™ºç”¨ã®ãƒ„ãƒ¼ãƒ«ã€‚é«˜é€Ÿã«é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¡ä¸Šã’ã¦ãã‚Œã‚‹
- **Express**
  - Node.js ä¸Šã§å‹•ã Web ã‚µãƒ¼ãƒãƒ¼ã‚’ä½œã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯
  - ã€Œ`GET /api/projects` ã«æ¥ãŸã‚‰ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’è¿”ã™ã€ãªã©ã‚’å®šç¾©
- **SQLite + better-sqlite3**
  - SQLite â€¦ ãƒ•ã‚¡ã‚¤ãƒ« 1 ã¤ã§å®Œçµã™ã‚‹è»½é‡ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
  - `server/var/app.db` ã«ä¿å­˜ã•ã‚Œã‚‹
- **Zod**
  - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
  - ã€Œã“ã® API ã§ã¯ã€`title` ã¯å¿…é ˆã®æ–‡å­—åˆ—ã§ã™ã€ãªã©ã‚’å®šç¾©ã—ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹

---

## 4. å‡¦ç†ã®æµã‚Œï¼ˆã‚µãƒ¼ãƒãƒ¼å´ï¼‰

### 4.1 ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚

`server/src/presentation/server.ts` ã®å†’é ­ã§ã€æ¬¡ã® 2 ã¤ãŒå‘¼ã°ã‚Œã¾ã™ã€‚

- `runMigrations()` â€¦ ãƒ†ãƒ¼ãƒ–ãƒ«ãŒãªã‘ã‚Œã°ä½œã‚‹ / å¿…è¦ãªåˆ—ã‚’è¿½åŠ ã™ã‚‹
- `seedDemoData()` â€¦ ãƒ‡ãƒ¢ç”¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ DB ã«æŠ•å…¥

ãã®å¾Œã€Express ã‚¢ãƒ—ãƒª (`app`) ã‚’ä½œã‚Šã€æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

ä¾‹ï¼š

- `GET /api/projects`
  - `projectService.listProjects()` ã‚’å‘¼ã³ã€ä¸€è¦§ã‚’ JSON ã§è¿”ã™
- `GET /api/projects/:projectId/hierarchy`
  - `projectService.getHierarchy()` ã‚’å‘¼ã³ã€Phase â†’ Work â†’ Task â†’ Todo ã‚’ã¾ã¨ã‚ã¦è¿”ã™
- `POST /api/projects`
  - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’ Zod ã§ãƒã‚§ãƒƒã‚¯ã—ã¦ã‹ã‚‰ `projectService.createProject()` ã‚’å‘¼ã¶

ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã¨ãã¯ã€æœ€å¾Œã® `app.use((err, _req, res, _next) => { ... })` ã®ç®‡æ‰€ã§

- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆZodErrorï¼‰ â†’ 400
- è¦‹ã¤ã‹ã‚‰ãªã„ï¼ˆNotFoundErrorï¼‰ â†’ 404
- ãã®ä»– â†’ 500

ã¨ã„ã£ãŸ HTTP ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿”ã—ã¾ã™ã€‚

### 4.2 projectService ã®å½¹å‰²

`server/src/application/projectService.ts` ã¯ã€**ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼ˆæ©Ÿèƒ½å˜ä½ã®å‡¦ç†ï¼‰** ã‚’ã¾ã¨ã‚ãŸå ´æ‰€ã§ã™ã€‚

ä»£è¡¨çš„ãªãƒ¡ã‚½ãƒƒãƒ‰ï¼š

- `listProjects()`
  - `projectRepository.list()` ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’å–å¾—
  - `projectRepository.getTodoStats()` ã§ Todo ã®å®Œäº†æ•°ãªã©ã‚’å–å¾—
  - `calculateProjectProgress()` ã§é€²æ—ç‡ã‚’è¨ˆç®—
- `getHierarchy(projectId)`
  - `hierarchyRepository.listHierarchy()` ã§ Phase / Work / Task / Todo ã‚’å…¨éƒ¨å–å¾—
  - å­è¦ç´ ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‹ã‚‰é€²æ—ç‡ã‚’è¨ˆç®—ã—ã€å…¥ã‚Œå­æ§‹é€ ã®ãƒ‡ãƒ¼ã‚¿ã‚’çµ„ã¿ç«‹ã¦ã‚‹
- `createPhase / createWork / createTask / createTodo`
  - ãã‚Œãã‚Œå¿…è¦ãª Repository ã‚’å‘¼ã³å‡ºã—ã¦ DB ã«ä¿å­˜
  - ä½œæˆæ™‚ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒæŒ‡å®šã•ã‚Œã¦ã„ãªã‘ã‚Œã° `NOT_STARTED` ã«ã™ã‚‹
- `updatePhase / updateWork / updateTask / updateTodo`
  - éƒ¨åˆ†æ›´æ–°ï¼ˆPATCHï¼‰ã‚’ Repository ã«å§”è­²

### 4.3 Repository ã¨ DB

`server/src/infrastructure/repositories/` ã§ã¯ã€SQL ã‚’ç›´æ¥æ›¸ã„ã¦ã„ã¾ã™ã€‚

- `hierarchyRepository.ts`
  - `listHierarchy()` ã§éšå±¤ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ°—ã«å–å¾—
  - `createPhase/Work/Task/Todo()` ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ INSERT
  - `updateEntity()` ã§å…±é€šã® UPDATE å‡¦ç†
  - `reorder()` ã§å„è¡Œã® `orderIndex` ã‚’ã¾ã¨ã‚ã¦æ›´æ–°
  - `listTodayTodos()` ã§ã€ŒæœŸé™æ—¥ãŒä»Šæ—¥ã€ã® Todo ã‚’æŠ½å‡º
- `projectRepository.ts`
  - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚„ Todo ã®ä»¶æ•°é›†è¨ˆã‚’æ‹…å½“

---

## 5. å‡¦ç†ã®æµã‚Œï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ï¼‰

### 5.1 ç”»é¢ã®å…¨ä½“åƒ

`web/src/App.tsx` ãŒãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®å…¥å£ã§ã™ã€‚

æŒã£ã¦ã„ã‚‹ä¸»ãª stateï¼ˆçŠ¶æ…‹ï¼‰ï¼š

- `projects` â€¦ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§
- `selectedProjectId` â€¦ ä»Šé¸ã‚“ã§ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ID
- `hierarchy` â€¦ ç¾åœ¨ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®éšå±¤ï¼ˆPhase / Work / Task / Todoï¼‰
- `todayTodos` â€¦ ä»Šæ—¥ã‚„ã‚‹ã¹ã Todo ãƒªã‚¹ãƒˆ
- `error` â€¦ ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

ä¸»ãªå‡¦ç†ï¼š

- åˆå›è¡¨ç¤ºæ™‚ï¼š`useEffect` ã§ `api.fetchProjects()` ã‚’å‘¼ã³ã€å…ˆé ­ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è‡ªå‹•é¸æŠ
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé¸æŠå¤‰æ›´æ™‚ï¼š
  - `api.fetchHierarchy()` ã§éšå±¤ã‚’èª­ã¿è¾¼ã‚€
  - `api.fetchTodayTodos()` ã§ä»Šæ—¥ã® Todo ã‚’èª­ã¿è¾¼ã‚€
- `mutate()` ã¨ã„ã†é–¢æ•°ã‚’çµŒç”±ã—ã¦ã€æ›´æ–°ç³» API ã‚’å‘¼ã³å‡ºã™
  - ä¾‹ï¼šTodo ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã€Phase ã®ä½œæˆãƒ»å‰Šé™¤ãªã©
  - æ›´æ–°å¾Œã¯ `hierarchy` ã¨ `todayTodos` ã‚’å†èª­ã¿è¾¼ã¿
  - å¿…è¦ã«å¿œã˜ã¦ `projects` ã‚‚å†å–å¾—ã—ã¦ã€ä¸€è¦§ã®ã‚«ãƒ¼ãƒ‰ã«å‡ºã¦ã„ã‚‹é€²æ—ç‡ã‚’æ›´æ–°

### 5.2 api.ts ã®å½¹å‰²

`web/src/api.ts` ã¯ã€**ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã®é€šä¿¡ã‚’ã¾ã¨ã‚ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«**ã§ã™ã€‚

- `const API_BASE = import.meta.env.VITE_API_URL ?? 'http://localhost:4000/api';`
  - `.env` ã« `VITE_API_URL` ãŒã‚ã‚Œã°ãã‚Œã‚’ä½¿ã†
  - ãªã‘ã‚Œã° `http://localhost:4000/api` ã‚’ä½¿ã†ï¼ˆé–‹ç™ºç”¨ï¼‰
- `request<T>(path, options)` ã§
  - `fetch` ã‚’å‘¼ã¶
  - 200ç³»ã§ã‚ã‚Œã° JSON ã‚’ãƒ‘ãƒ¼ã‚¹
  - 204 ã®ã¨ãã¯ `undefined` ã‚’è¿”ã™
  - ã‚¨ãƒ©ãƒ¼ã®ã¨ãã¯ `Error` ã‚’æŠ•ã’ã‚‹
- ãã‚Œã‚’ä½¿ã£ã¦
  - `fetchProjects`, `fetchHierarchy`, `createTodo`, `deleteTask` ãªã©ã®é–¢æ•°ã‚’å®šç¾©

---

## 6. é–‹ç™ºç’°å¢ƒã§ã®å‹•ã‹ã—æ–¹

ã“ã“ã§ã¯ **ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ** ã‚’å‰æã«èª¬æ˜ã—ã¾ã™ã€‚  
ï¼ˆVSCode ã‚’ä½¿ã†å ´åˆã§ã‚‚ã€ã¾ãšã¯ã‚³ãƒãƒ³ãƒ‰ã§å‹•ã‹ã—ã¦ã¿ã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ï¼‰

### 6.1 å‰æ

- Node.js ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã“ã¨ï¼ˆã ã„ãŸã„ v18 ä»¥ä¸Šãªã‚‰ OKï¼‰
- ã“ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã« clone æ¸ˆã¿

### 6.2 ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`project_manage_todo`ï¼‰ã§æ¬¡ã‚’å®Ÿè¡Œï¼š

```bash
npm install
```

`package.json` ã® `workspaces` ã«ã‚ˆã‚Šã€`server` ã¨ `web` ä¸¡æ–¹ã®ä¾å­˜ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¾ã™ã€‚

### 6.3 ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆserverï¼‰ã®èµ·å‹•

```bash
cd server
npm run dev
```

- `ts-node-dev` ã§ `src/presentation/server.ts` ãŒèµ·å‹•ã—ã¾ã™
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ `http://localhost:4000` ã§å¾…ã¡å—ã‘ã¾ã™ï¼ˆ`/api/...` ãŒ APIï¼‰

ãƒ­ã‚°ã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã„ãªã‘ã‚Œã°èµ·å‹•æˆåŠŸã§ã™ã€‚

### 6.4 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆwebï¼‰ã®èµ·å‹•

åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ã„ã¦ï¼š

```bash
cd web
npm run dev
```

- Vite ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™
- é€šå¸¸ã¯ `http://localhost:5173` ãªã©ã® URL ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¾ã™
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ç¹‹ãŒã£ã¦ã„ã‚Œã°ã€ãƒ‡ãƒ¢ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒ1ã¤è¡¨ç¤ºã•ã‚Œã¾ã™

---

## 7. VSCode ã§ã®ãƒ‡ãƒãƒƒã‚°ã®åŸºæœ¬

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä¸»ã«æ¬¡ã® 2 ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒ‡ãƒãƒƒã‚°æ–¹æ³•ã‚’æƒ³å®šã§ãã¾ã™ã€‚

1. **ã‚µãƒ¼ãƒãƒ¼å´ï¼ˆExpress + TypeScriptï¼‰ã‚’ãƒ‡ãƒãƒƒã‚°**
2. **ãƒ•ãƒ­ãƒ³ãƒˆå´ï¼ˆReactï¼‰ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ DevTools ã§ãƒ‡ãƒãƒƒã‚°**

â€» `.vscode/launch.json` ãŒã¾ã ç©ºãªã®ã§ã€å¿…è¦ã§ã‚ã‚Œã°ä»Šå¾Œã“ã“ã«è¨­å®šã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

### 7.1 ã‚µãƒ¼ãƒãƒ¼å´ã®ãƒ‡ãƒãƒƒã‚°ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰

è¶…åˆå¿ƒè€…å‘ã‘ã«ã¯ã€ã¾ãšã¯ **ãƒ­ã‚°ã‚’å‡ºã—ã¦å‹•ãã‚’è¿½ã†** æ–¹æ³•ãŒãŠã™ã™ã‚ã§ã™ã€‚

- æ°—ã«ãªã‚‹ç®‡æ‰€ã« `console.log('ã“ã“ã¾ã§ããŸ', å¤‰æ•°)` ã‚’æ›¸ã
- ä¾‹ï¼š`server/src/application/projectService.ts` ã®ä¸­ã§ã©ã‚“ãªãƒ‡ãƒ¼ã‚¿ãŒæµã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
- `npm run dev` ã‚’ã—ã¦ã„ã‚‹ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™

æ…£ã‚Œã¦ããŸã‚‰ã€VSCode ã®ãƒ‡ãƒãƒƒã‚¬ãƒ¼ã‚’ä½¿ã†æ–¹æ³•ã‚‚æ¤œè¨ã§ãã¾ã™ã€‚

### 7.2 ãƒ•ãƒ­ãƒ³ãƒˆå´ã®ãƒ‡ãƒãƒƒã‚°

ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆChrome ãªã©ï¼‰ã§ DevTools ã‚’é–‹ãã¾ã™ã€‚

- Windows: `F12` ã¾ãŸã¯ `Ctrl + Shift + I`
- Mac: `Cmd + Option + I`

ã‚ˆãä½¿ã†ã‚¿ãƒ–ï¼š

- **Console**
  - `console.log` ã®å†…å®¹ã‚„ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
  - ã‚¨ãƒ©ãƒ¼ãŒèµ·ããŸã¨ãã¯ã€ã“ã“ã‚’ã¾ãšç¢ºèª
- **Network**
  - API ã®å‘¼ã³å‡ºã—çµæœã‚’ç¢ºèªã§ãã‚‹
  - ä¾‹ãˆã° `GET /api/projects` ãŒ 500 ã«ãªã£ã¦ã„ãªã„ã‹ï¼Ÿãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã¯ã©ã†ã‹ï¼Ÿãªã©ã‚’è¦‹ã‚‹

React ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ã‚‚ã€`console.log(props, state)` ã‚’ä»•è¾¼ã‚“ã§å€¤ã‚’ç¢ºèªã™ã‚‹ã¨ç†è§£ãŒé€²ã¿ã¾ã™ã€‚

---

## 8. ã©ã“ã‹ã‚‰èª­ã‚ã°ã„ã„ã‹ï¼ˆå­¦ç¿’ã®é †ç•ªï¼‰

ã€Œå…¨éƒ¨ç†è§£ã—ãªã„ã¨ã„ã‘ãªã„ã€ã¨æ€ã†ã¨å¤§å¤‰ãªã®ã§ã€**æ¬¡ã®é †ç•ª**ã§å°‘ã—ãšã¤èª­ã‚€ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚

1. `è¦ä»¶å®šç¾©æ›¸.md`
   - ã¾ãšã¯ã€Œã“ã®ã‚¢ãƒ—ãƒªã§ä½•ãŒã—ãŸã„ã‹ã€ã€Œã©ã†ã„ã†æ©Ÿèƒ½ãŒã‚ã‚‹ã‹ã€ã‚’ã–ã£ãã‚Šæ´ã‚€
2. `ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä»•æ§˜æ›¸.md`
   - ãƒ¬ã‚¤ãƒ¤ãƒ¼æ§‹é€ ã‚„ã€ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½•ã‚’ã—ã¦ã„ã‚‹ã‹ã‚’ç¢ºèª
3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‹ã‚‰çœºã‚ã‚‹
   - `web/src/App.tsx` â†’ `components/HierarchyView.tsx` ã‚’èª­ã‚€
   - UI ã®å‹•ãã¨ã€ã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ `api.ts` ã‚’å‘¼ã‚“ã§ã„ã‚‹ã‹ã‚’è¦‹ã‚‹
4. API å´ã‚’è¦‹ã‚‹
   - `web/src/api.ts` ã‚’è¦‹ã¦ã€ã€Œã“ã®é–¢æ•°ã¯ `/api/xxx` ã‚’å©ã„ã¦ã„ã‚‹ã‚“ã ãªã€ã¨ç†è§£ã™ã‚‹
   - æ¬¡ã« `server/src/presentation/server.ts` ã‚’è¦‹ã¦ã€ã€Œãã® URL ã®å‡¦ç†ãŒã©ã“ã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‹ã€ã‚’ç¢ºèª
5. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¦‹ã‚‹
   - `server/src/application/projectService.ts` ã§ã€å®Ÿéš›ã«ã©ã‚“ãªé †ç•ªã§å‡¦ç†ãŒèµ°ã£ã¦ã„ã‚‹ã‹ã‚’è¿½ã†
6. DB å‘¨ã‚Š
   - ä½™è£•ãŒã‚ã‚Œã° `server/src/infrastructure/repositories/*.ts` ã‚„ `migrations.ts` ã‚’èª­ã¿ã€SQL ã«æ…£ã‚Œã¦ã„ã

---

## 9. ã‚ˆãã‚ã‚Šãã†ãªãƒˆãƒ©ãƒ–ãƒ«ã¨ãƒ’ãƒ³ãƒˆ

- **ãƒ–ãƒ©ã‚¦ã‚¶ã«ä½•ã‚‚è¡¨ç¤ºã•ã‚Œãªã„ / ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹**
  - `server` ã® `npm run dev` ãŒã¡ã‚ƒã‚“ã¨å‹•ã„ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„
  - ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒèµ·å‹•ã—ã¦ã„ãªã„ã¨ã€ãƒ•ãƒ­ãƒ³ãƒˆã‹ã‚‰ã® API å‘¼ã³å‡ºã—ãŒå¤±æ•—ã—ã¾ã™
- **CORS ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹**
  - `server/src/presentation/server.ts` ã§ã¯ `app.use(cors());` ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€é€šå¸¸ã¯ CORS ã§è©°ã¾ã‚‰ãªã„æƒ³å®šã§ã™
  - ã‚‚ã—ãƒãƒ¼ãƒˆç•ªå·ãªã©ã‚’å¤‰ãˆãŸå ´åˆã¯ã€ã“ã®è¨­å®šã‚‚è¦‹ç›´ã™å¿…è¦ãŒã‚ã‚Šã¾ã™
- **DB å‘¨ã‚Šã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹**
  - `server/var/app.db` ã‚’ä¸€åº¦æ¶ˆã—ã¦ã‚„ã‚Šç›´ã™ã¨ç›´ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼ˆé‡è¦ãªãƒ‡ãƒ¼ã‚¿ãŒãªã„é–‹ç™ºä¸­ã ã‘ã«ã—ã¦ãã ã•ã„ï¼‰
  - èµ·å‹•æ™‚ã« `runMigrations()` ã¨ `seedDemoData()` ãŒå†åº¦å®Ÿè¡Œã•ã‚Œã¾ã™

---

## 10. ä»Šå¾Œã®æ‹¡å¼µã‚’è€ƒãˆã‚‹ã¨ãã®ãƒã‚¤ãƒ³ãƒˆ

ã‚‚ã—ä»Šå¾Œã€æ©Ÿèƒ½è¿½åŠ ãªã©ã‚’ã—ãŸããªã£ãŸã¨ãã¯ã€ã ã„ãŸã„æ¬¡ã®æµã‚Œã§è€ƒãˆã‚‹ã¨æ•´ç†ã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

1. è¦ä»¶ã‚’æ•´ç†ã™ã‚‹ï¼ˆ`è¦ä»¶å®šç¾©æ›¸.md` ã«è¿½è¨˜ï¼‰
2. ã©ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æ‰‹ã‚’å…¥ã‚Œã‚‹ã‹è€ƒãˆã‚‹
   - UI ã ã‘ï¼Ÿï¼ˆãƒ•ãƒ­ãƒ³ãƒˆï¼‰  
   - æ–°ã—ã„ API ãŒå¿…è¦ï¼Ÿï¼ˆãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ + ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ + ã‚¤ãƒ³ãƒ•ãƒ©ï¼‰  
3. ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å‹ãŒå¢—ãˆã‚‹ã‹ã©ã†ã‹æ¤œè¨ã™ã‚‹ï¼ˆ`entities.ts`ï¼‰
4. `projectService` ã«ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ 
5. Repository/DB ã«åˆ—ã‚’è¶³ã™ãªã‚‰ã€`migrations.ts` ã‚’æ›´æ–°

ã€Œã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã©ã®å½¹å‰²ã‹ã€ã‚’ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§æŒ¯ã‚Šè¿”ã‚ŠãªãŒã‚‰é€²ã‚ã‚‹ã¨ã€è¿·ã„ã«ãããªã‚‹ã¯ãšã§ã™ã€‚

---

## 11. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°ã€œé€²æ—åæ˜ ã¾ã§ã‚’ã‚³ãƒ¼ãƒ‰ã§è¿½ã†

ã“ã“ã§ã¯ã€**Todo ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’ã€Œæœªç€æ‰‹ â†’ å®Œäº†ã€ã«å¤‰ãˆãŸã¨ã**ã«ã€

> ç”»é¢ã®æ“ä½œ â†’ API å‘¼ã³å‡ºã— â†’ DB æ›´æ–° â†’ é€²æ—è¨ˆç®— â†’ ç”»é¢ã«åæ˜ 

ã¾ã§ãŒã€å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰ã®ã©ã“ã‚’é€šã£ã¦ã„ã‚‹ã‹ã‚’ä¸€ã¤ä¸€ã¤è¿½ã£ã¦ã„ãã¾ã™ã€‚

### 11.1 ç”»é¢ã§ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å¤‰æ›´ã™ã‚‹ï¼ˆReact ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰

ä¾‹ã¨ã—ã¦ã€ãƒ¡ã‚¤ãƒ³ã®éšå±¤ç”»é¢ã§ Todo ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å¤‰ãˆã‚‹å ´åˆã‚’è¦‹ã¾ã™ã€‚

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`web/src/components/HierarchyView.tsx`
- Todo ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹éƒ¨åˆ†ï¼ˆ`TodoRow` å†…ï¼‰

```tsx
<StatusSelect value={todo.status} onChange={(status) => updateTodo(todo.id, { status })} />
```

- `StatusSelect` ã¯ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼ˆã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ï¼‰ã§ã™ã€‚
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå€¤ã‚’å¤‰æ›´ã™ã‚‹ã¨ã€`onChange` ã«æ¸¡ã—ãŸé–¢æ•°ãŒå‘¼ã°ã‚Œã¾ã™ã€‚
- ã“ã“ã§ã¯ `updateTodo(todo.id, { status })` ãŒå‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚

`updateTodo` ã®ä¸­èº«ï¼ˆæŠœç²‹ï¼‰ï¼š

```tsx
async function updateTodo(id: string, patch: Record<string, unknown>) {
  try {
    await handlers.onUpdateTodo(id, patch);
  } catch (err) {
    console.error(err);
    alert('Todo ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
}
```

ã“ã“ã§ `handlers.onUpdateTodo` ã¯ã€`HierarchyView` ã®è¦ªã§ã‚ã‚‹ `App.tsx` ã‹ã‚‰æ¸¡ã•ã‚Œã¦ã„ã¾ã™ã€‚

### 11.2 App ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ API å‘¼ã³å‡ºã—ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`web/src/App.tsx`

`HierarchyView` ã‚’å‘¼ã³å‡ºã—ã¦ã„ã‚‹ã¨ã“ã‚ï¼ˆæŠœç²‹ï¼‰ï¼š

```tsx
<HierarchyView
  phases={hierarchy.phases}
  onUpdateTodo={(id, patch) => mutate(() => api.patchEntity('todos', id, patch), true)}
  ...
/>
```

ãƒã‚¤ãƒ³ãƒˆï¼š

- `onUpdateTodo` ã«ã€`mutate(() => api.patchEntity('todos', id, patch), true)` ã‚’æ¸¡ã—ã¦ã„ã¾ã™ã€‚
- ã¤ã¾ã‚Šã€`HierarchyView` ã‹ã‚‰è¦‹ã‚‹ã¨
  - ã€ŒTodo æ›´æ–°ã—ã¦ã€ã¨é ¼ã¾ã‚Œã‚‹
  - â†’ `mutate` ã‚’é€šã˜ã¦ `api.patchEntity` ãŒå‘¼ã°ã‚Œã‚‹

`mutate` ã®ä¸­èº«ï¼ˆæŠœç²‹ï¼‰ï¼š

```ts
async function mutate(action: () => Promise<any>, refreshProjectsAfter = false) {
  if (!selectedProjectId) return;
  setError(null);
  try {
    await action();
    await Promise.all([refreshHierarchy(selectedProjectId), refreshTodayTodos(selectedProjectId)]);
    if (refreshProjectsAfter) {
      await loadProjects();
    }
  } catch (err) {
    console.error(err);
    setError('æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
}
```

ã‚„ã£ã¦ã„ã‚‹ã“ã¨ï¼š

1. `action()` ã‚’å®Ÿè¡Œï¼ˆä»Šå›ã®ä¾‹ã§ã¯ `api.patchEntity('todos', id, patch)`ï¼‰
2. æˆåŠŸã—ãŸã‚‰
   - `refreshHierarchy` ã§éšå±¤ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—
   - `refreshTodayTodos` ã§ä»Šæ—¥ã® Todo ã‚’å†å–å¾—
   - `refreshProjectsAfter` ãŒ `true`ï¼ˆTodo ã®å ´åˆã¯ `true`ï¼‰ãªã®ã§ã€`loadProjects()` ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚‚å†å–å¾—

â†’ ã“ã“ã§ã€ã€Œã‚µãƒ¼ãƒãƒ¼å´ã®æ›´æ–°å¾Œã«ã€é€²æ—ã‚„ä»¶æ•°ã‚’æœ€æ–°çŠ¶æ…‹ã§å–ã‚Šç›´ã™ã€ã“ã¨ã‚’ã—ã¦ã„ã¾ã™ã€‚

### 11.3 api.ts ã§ REST API ã‚’å©ã

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`web/src/api.ts`

`patchEntity` ã®å®šç¾©ï¼š

```ts
patchEntity(type: 'phases' | 'works' | 'tasks' | 'todos', id: string, payload: Record<string, unknown>): Promise<void> {
  return request<void>(`/${type}/${id}`, {
    method: 'PATCH',
    body: JSON.stringify(payload),
  });
}
```

ä»Šå›ã® Todo ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã®å ´åˆï¼š

- `type` ã¯ `'todos'`
- `id` ã¯ Todo ã® ID
- `payload` ã¯ `{ status: 'DONE' }` ã®ã‚ˆã†ãªå½¢

ã¤ã¾ã‚Šã€HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ï¼š

- ãƒ¡ã‚½ãƒƒãƒ‰ï¼š`PATCH`
- URLï¼š`/api/todos/:id`ï¼ˆå®Ÿéš›ã¯ `API_BASE` ãŒå…ˆé ­ã«ä»˜ãã¾ã™ï¼‰
- ãƒœãƒ‡ã‚£ï¼š`{ "status": "DONE" }`

ã“ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã‚‹ã‚µãƒ¼ãƒãƒ¼å´ãŒæ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚

### 11.4 Express ã‚µãƒ¼ãƒãƒ¼ã§ PATCH ã‚’å—ã‘å–ã‚‹

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`server/src/presentation/server.ts`

Todo ã®æ›´æ–°ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆæŠœç²‹ï¼‰ï¼š

```ts
app.patch('/api/todos/:id', (req, res) => {
  const { id } = req.params;
  const body = todoPatchSchema.parse(req.body ?? {});
  projectService.updateTodo(id, body);
  res.json({ ok: true });
});
```

ã“ã“ã§ã‚„ã£ã¦ã„ã‚‹ã“ã¨ï¼š

1. `req.params.id` ã‹ã‚‰ Todo ã® ID ã‚’å–ã‚Šå‡ºã™
2. `req.body` ã‚’ `todoPatchSchema`ï¼ˆZodï¼‰ã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã™ã‚‹
   - ã“ã‚Œã«ã‚ˆã‚Šã€ã€Œ`status` ã¯ `'NOT_STARTED' | 'IN_PROGRESS' | 'DONE'` ã®ã©ã‚Œã‹ã€ãªã©ã‚’ãƒã‚§ãƒƒã‚¯
3. å•é¡Œãªã‘ã‚Œã° `projectService.updateTodo(id, body)` ã‚’å‘¼ã¶
4. æœ€å¾Œã« `{ ok: true }` ã‚’è¿”ã™

ã“ã“ã¾ã§ã§ã€ã€ŒHTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒ“ã‚¹ã«æ¸¡ã™ã€å½¹ç›®ãŒå®Œäº†ã—ã¦ã„ã¾ã™ã€‚

### 11.5 projectService ã§ã€ŒTodo æ›´æ–°ã€ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã‚’å‘¼ã¶

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`server/src/application/projectService.ts`

```ts
updateTodo(id: string, patch: TodoUpdate) {
  hierarchyRepository.updateTodo(id, patch);
},
```

ã“ã®é–¢æ•°è‡ªä½“ã¯ã‚·ãƒ³ãƒ—ãƒ«ã§ã€

- ã€ŒTodo ã®æ›´æ–°ã¯ `hierarchyRepository` ã«ä»»ã›ã‚‹ã€

ã¨ã„ã†å½¹å‰²åˆ†æ‹…ã«ãªã£ã¦ã„ã¾ã™ã€‚

â€»å®Ÿéš›ã®ã€Œé€²æ—è¨ˆç®—ã€ã¯ã“ã“ã§ã¯è¡Œã£ã¦ãŠã‚‰ãšã€**æ¬¡ã«éšå±¤ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã¨ãã«ã¾ã¨ã‚ã¦è¨ˆç®—**ã—ã¾ã™ï¼ˆå¾Œè¿°ï¼‰ã€‚

### 11.6 Repository ã§ DB ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã™ã‚‹

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`server/src/infrastructure/repositories/hierarchyRepository.ts`

```ts
updateTodo(id: string, patch: Partial<Omit<Todo, 'id' | 'projectId' | 'createdAt'>>) {
  const payload: Record<string, unknown> = { ...patch };
  if (patch.todayFlag !== undefined) {
    payload.todayFlag = patch.todayFlag ? 1 : 0;
  }
  this.updateEntity('todos', id, payload);
},
```

ãƒã‚¤ãƒ³ãƒˆï¼š

- Todo ã®æ›´æ–°ã¯ã€å…±é€šé–¢æ•° `updateEntity` ã«æŠ•ã’ã¦ã„ã¾ã™ã€‚
- `todayFlag` ã ã‘ã¯ DB ä¸Šã¯ `0/1` ã®æ•´æ•°ãªã®ã§ã€ã“ã“ã§ boolean ã‹ã‚‰å¤‰æ›ã—ã¦ã„ã¾ã™ã€‚

`updateEntity` ã®ä¸­èº«ï¼š

```ts
updateEntity(table: string, id: string, patch: Record<string, unknown>) {
  const entries = Object.entries(patch).filter(([_, value]) => value !== undefined);
  if (entries.length === 0) return;

  const sets = entries.map(([key]) => `${key} = @${key}`);
  const stmt = db.prepare(`UPDATE ${table} SET ${sets.join(', ')} WHERE id = @id`);
  stmt.run({ ...Object.fromEntries(entries), id });
}
```

ã“ã“ã§ã€

- `patch` ã®ä¸­ã‹ã‚‰ `undefined` ã§ã¯ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã ã‘ã‚’å–ã‚Šå‡ºã—
- `UPDATE todos SET status = @status WHERE id = @id` ã®ã‚ˆã†ãª SQL ã‚’çµ„ã¿ç«‹ã¦ã¦
- `db.run(...)` ã§å®Ÿéš›ã« DB ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã§ã€**DB ä¸Šã® Todo ã® `status` ãŒæ›´æ–°**ã•ã‚Œã¾ã—ãŸã€‚

### 11.7 éšå±¤ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ã™ã‚‹ã¨ãã«é€²æ—ã‚’è¨ˆç®—ã™ã‚‹

å‰ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ11.2ï¼‰ã§è¦‹ãŸã‚ˆã†ã«ã€ãƒ•ãƒ­ãƒ³ãƒˆå´ã§ã¯ Todo ã‚’æ›´æ–°ã—ãŸã‚ã¨ã«

- `refreshHierarchy(selectedProjectId)`
- `refreshTodayTodos(selectedProjectId)`
- `loadProjects()`

ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚  
ã“ã®ã†ã¡ **é€²æ—ã«é–¢ä¿‚ã™ã‚‹ã®ã¯ `refreshHierarchy` ã¨ `loadProjects`** ã§ã™ã€‚

#### 11.7.1 éšå±¤ã®é€²æ—ï¼ˆPhase/Work/Task.progressï¼‰

`refreshHierarchy` ã¯æ¬¡ã® API ã‚’å©ãã¾ã™ï¼š

- `GET /api/projects/:projectId/hierarchy`
  - â†’ `server/src/presentation/server.ts` ã‹ã‚‰
  - â†’ `projectService.getHierarchy(projectId)` ãŒå‘¼ã°ã‚Œã¾ã™ã€‚

`projectService.getHierarchy` ã®ä¸­ã§ã‚„ã£ã¦ã„ã‚‹ã“ã¨ï¼ˆã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰ï¼š

1. `hierarchyRepository.listHierarchy(projectId)` ã§
   - phases / works / tasks / todos ã‚’å…¨éƒ¨ DB ã‹ã‚‰èª­ã¿å‡ºã™
2. Task ã”ã¨ã«ã€ãã® Task é…ä¸‹ã® Todo ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é›†ã‚ã‚‹
3. `deriveProgressFromStatuses` ã‚’ä½¿ã£ã¦ Task.progress ã‚’è¨ˆç®—
4. Work ã”ã¨ã«ã€ãã® Work é…ä¸‹ã® Task ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é›†ã‚ã¦ Work.progress ã‚’è¨ˆç®—
5. Phase ã”ã¨ã«ã€ãã® Phase é…ä¸‹ã® Work ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’é›†ã‚ã¦ Phase.progress ã‚’è¨ˆç®—

ã‚³ãƒ¼ãƒ‰ï¼ˆæŠœç²‹ï¼‰ï¼š

```ts
const tasksByWork = new Map<string, TaskNode[]>();
tasks.forEach((task) => {
  const childTodos = todosByTask.get(task.id) ?? [];
  const progress = deriveProgressFromStatuses(
    childTodos.map((todo) => todo.status),
    task.status,
  );
  const node: TaskNode = { ...task, todos: childTodos, progress };
  ...
});
```

`deriveProgressFromStatuses` ã®ä¸­èº«ï¼š

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`server/src/application/projectService.ts`

```ts
function deriveProgressFromStatuses(childStatuses: TodoStatus[], ownStatus: TodoStatus): number {
  if (childStatuses.length === 0) {
    return progressFromStatus(ownStatus);
  }
  return calculateProgressFromStatuses(childStatuses);
}
```

ã“ã“ã§ä½¿ã£ã¦ã„ã‚‹ `progressFromStatus` / `calculateProgressFromStatuses` ã¯

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`server/src/domain/progress.ts`

```ts
function statusToProgressValue(status: TodoStatus): number {
  switch (status) {
    case 'DONE':
      return 1;
    case 'IN_PROGRESS':
      return 0.5;
    default:
      return 0;
  }
}

export function calculateProgressFromStatuses(statuses: TodoStatus[]): number {
  if (statuses.length === 0) {
    return 0;
  }

  const total = statuses.reduce((acc, status) => acc + statusToProgressValue(status), 0);
  return Math.round((total / statuses.length) * 100);
}
```

ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼š

- `DONE` = 1.0ï¼ˆ100%ï¼‰
- `IN_PROGRESS` = 0.5ï¼ˆ50%ï¼‰
- `NOT_STARTED` = 0.0ï¼ˆ0%ï¼‰

å­è¦ç´ ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å…¨éƒ¨æ•°å€¤ã«å¤‰æ›ã—ã¦å¹³å‡ã—ã€`0ã€œ100` ã®æ•´æ•°ã«ä¸¸ã‚ã¦ã„ã¾ã™ã€‚

â†’ ã¤ã¾ã‚Šã€**Todo ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å¤‰ãˆã¦ã‹ã‚‰éšå±¤ã‚’å†å–å¾—ã™ã‚‹ã¨ã€ãã®æœ€æ–°ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å…ƒã« Task / Work / Phase ã®é€²æ—ãŒå†è¨ˆç®—ã•ã‚Œã‚‹**ã€ã¨ã„ã†ä»•çµ„ã¿ã§ã™ã€‚

#### 11.7.2 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚«ãƒ¼ãƒ‰ã®é€²æ—ï¼ˆProject.progressï¼‰

`loadProjects()` ã¯ `api.fetchProjects()` ã‚’å‘¼ã³ã¾ã™ã€‚

- ã‚µãƒ¼ãƒãƒ¼å´ï¼š`GET /api/projects`
  - â†’ `projectService.listProjects()` ã‚’å‘¼ã¶

`listProjects` ã®ä¸­ã§ï¼š

```ts
listProjects(): ProjectSummary[] {
  const projects = projectRepository.list();
  return projects.map((project) => {
    const stats = projectRepository.getTodoStats(project.id);
    const progress = calculateProjectProgress(project.id);
    return {
      ...project,
      progress,
      todoCounts: {
        total: stats.total,
        done: stats.done,
      },
    };
  });
},
```

ã“ã“ã§

- `calculateProjectProgress(project.id)` ãŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®é€²æ—ã‚’è¨ˆç®—ã—ã¾ã™ã€‚

`calculateProjectProgress`ï¼ˆæŠœç²‹ï¼‰ï¼š

```ts
function calculateProjectProgress(projectId: string): number {
  const { phases, works } = hierarchyRepository.listPlanningStatuses(projectId);

  const workStatusesByPhase = new Map<string, TodoStatus[]>();
  works.forEach((work) => {
    if (!workStatusesByPhase.has(work.phaseId)) {
      workStatusesByPhase.set(work.phaseId, []);
    }
    workStatusesByPhase.get(work.phaseId)!.push(work.status);
  });

  const phaseProgresses = phases.map((phase) => {
    const childStatuses = workStatusesByPhase.get(phase.id) ?? [];
    return deriveProgressFromStatuses(childStatuses, phase.status);
  });

  return combineProgress(phaseProgresses);
}
```

ã“ã“ã§ã‚‚ `deriveProgressFromStatuses` ã¨ `combineProgress` ã‚’ä½¿ã„ã€

- Phase ãƒ¬ãƒ™ãƒ«ã®é€²æ—
- ãã‚Œã‚‰ã‚’å¹³å‡ã—ãŸ Project ãƒ¬ãƒ™ãƒ«ã®é€²æ—

ã‚’è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚

â†’ çµæœã¨ã—ã¦ã€Todo ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã¯

1. Todo.status æ›´æ–°ï¼ˆDBï¼‰
2. Task.progressï¼ˆTodo é…ä¸‹ï¼‰
3. Work.progressï¼ˆTask é…ä¸‹ï¼‰
4. Phase.progressï¼ˆWork é…ä¸‹ï¼‰
5. Project.progressï¼ˆPhase é…ä¸‹ï¼‰

ã¨ã„ã†å½¢ã§ã€éšå±¤çš„ã«å½±éŸ¿ã—ã¦ã„ãã¾ã™ã€‚

### 11.7.3 Phase ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å¤‰ãˆãŸå ´åˆã®é•ã„

Todo ã§ã¯ãªã **Phase è‡ªä½“ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å¤‰æ›´**ã—ãŸå ´åˆã‚‚ã€æµã‚Œã¯ã»ã¼åŒã˜ã§ã™ã€‚

1. ç”»é¢ï¼ˆ`HierarchyView.tsx`ï¼‰ã® Phase éƒ¨åˆ†ï¼š

   ```tsx
   <StatusSelect value={phase.status} onChange={(status) => handlers.onUpdatePhase(phase.id, { status })} />
   ```

2. `App.tsx` ã‹ã‚‰æ¸¡ã—ã¦ã„ã‚‹ `onUpdatePhase`ï¼š

   ```tsx
   onUpdatePhase={(id, patch) => mutate(() => api.patchEntity('phases', id, patch))}
   ```

   - Todo ã¨åŒã˜ã‚ˆã†ã« `mutate` ã‚’é€šã˜ã¦ `PATCH /api/phases/:id` ãŒå‘¼ã°ã‚Œã¾ã™ã€‚

3. ã‚µãƒ¼ãƒãƒ¼å´ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼š

   - ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`server/src/presentation/server.ts`

   ```ts
   app.patch('/api/phases/:id', (req, res) => {
     const { id } = req.params;
     const body = planningPatchSchema.parse(req.body ?? {});
     projectService.updatePhase(id, body);
     res.json({ ok: true });
   });
   ```

4. `projectService.updatePhase` ã§ Repository ã¸å§”è­²ï¼š

   ```ts
   updatePhase(id: string, patch: BasePlanningUpdate) {
     hierarchyRepository.updatePhase(id, patch);
   },
   ```

5. Repository ã§ DB ã‚’æ›´æ–°ï¼š

   - ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`server/src/infrastructure/repositories/hierarchyRepository.ts`

   ```ts
   updatePhase(id: string, patch: Partial<Omit<Phase, 'id' | 'projectId' | 'createdAt'>>) {
     this.updateEntity('phases', id, patch);
   },
   ```

   â†’ `updateEntity` â†’ `UPDATE phases SET status = ... WHERE id = ...` ãŒå®Ÿè¡Œã•ã‚Œã€Phase ã® `status` ãŒå¤‰ã‚ã‚Šã¾ã™ã€‚

6. ãã®å¾Œã¯ Todo ã¨åŒã˜ãã€`mutate` ã®ä¸­ã§

   - `refreshHierarchy(selectedProjectId)` ãŒå‘¼ã°ã‚Œã€æœ€æ–°ã® Phase / Work / Task / Todo ã‚’èª­ã¿ç›´ã™
   - èª­ã¿ç›´ã—ã®ä¸­ã§ `deriveProgressFromStatuses` / `calculateProgressFromStatuses` ãŒä½¿ã‚ã‚Œã€é€²æ—ã‚’å†è¨ˆç®—

ã¨ã„ã†å½¢ã§ã€**Phase ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´ã‚‚ã€æ¬¡ã«éšå±¤ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§é€²æ—ã«åæ˜ **ã•ã‚Œã¾ã™ã€‚

### 11.8 æœ€å¾Œã« React ãŒå†æç”»ã—ã¦ç”»é¢ã«åæ˜ ã•ã‚Œã‚‹

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‹ã‚‰è¿”ã£ã¦ããŸæ–°ã—ã„ãƒ‡ãƒ¼ã‚¿ã¯ã€

- `setHierarchy(newHierarchy)`
- `setTodayTodos(newTodos)`
- `setProjects(newProjects)`

ã®ã‚ˆã†ã« `useState` ã«ã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ï¼ˆ`App.tsx` å†…ï¼‰ã€‚

React ã§ã¯ã€`setXxx` ãŒå‘¼ã°ã‚Œã¦ state ãŒå¤‰ã‚ã‚‹ã¨ã€è‡ªå‹•çš„ã«ãã® state ã‚’ä½¿ã£ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå†æç”»ã•ã‚Œã¾ã™ã€‚

ãã®çµæœã€

- `HierarchyView` ã«æ¸¡ã•ã‚Œã‚‹ `phases` ã® `progress` å€¤ãŒæ›´æ–°ã•ã‚Œ
- `ProgressBar` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã® `value` ãŒå¤‰ã‚ã‚‹
- ç”»é¢ä¸Šã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã¨æ•°å€¤ãŒæœ€æ–°ã®çŠ¶æ…‹ã«ãªã‚‹

ã¨ã„ã†æµã‚Œã§ã€**ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ â†’ ã‚µãƒ¼ãƒãƒ¼æ›´æ–° â†’ é€²æ—è¨ˆç®— â†’ ç”»é¢ã«åæ˜ **ã¾ã§ãŒã¤ãªãŒã£ã¦ã„ã¾ã™ã€‚

---

ä»¥ä¸ŠãŒã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãŠã‘ã‚‹ã€Œé …ç›®ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã—ãŸã‚‰ã€é€²æ—è¨ˆç®—ã—ã¦çµæœã«åæ˜ ã•ã‚Œã‚‹ã¾ã§ã€ã®ãƒ•ãƒ­ãƒ¼ã§ã™ã€‚  
æ…£ã‚Œãªã„ã†ã¡ã¯ã€ã€Œã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‘¼ã°ã‚Œã¦ã„ã‚‹ã‹ã€ã‚’ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¦‹ãªãŒã‚‰è¾¿ã£ã¦ã¿ã‚‹ã¨ã€å…¨ä½“åƒãŒã¤ã‹ã¿ã‚„ã™ããªã‚Šã¾ã™ã€‚

---

## 12. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®é€²æ—ã‚µãƒãƒªï¼ˆå¤§ãƒ»ä¸­ãƒ»å°ãƒ»Todo ã®ä»¶æ•°ï¼‰

### 12.1 ç”»é¢ä¸Šã§ã©ã“ã«è¦‹ãˆã‚‹ã‹

ãƒ¡ã‚¤ãƒ³ç”»é¢ã®ä¸Šéƒ¨ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã®å³å´ã«ã‚ã‚‹ã‚¨ãƒªã‚¢ï¼ˆ`project-header`ï¼‰ã§ã€æ¬¡ã®ã‚ˆã†ãªæƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

- å…¨ä½“ï¼š`å…¨ä½“ ã€‡ã€‡%`ï¼ˆ`currentProject.progress`ï¼‰
- å¤§é …ç›®ï¼š`å¤§é …ç›® å®Œäº†æ•°/ç·æ•°ï¼ˆxx%ï¼‰`
- ä¸­é …ç›®ï¼š`ä¸­é …ç›® å®Œäº†æ•°/ç·æ•°ï¼ˆxx%ï¼‰`
- å°é …ç›®ï¼š`å°é …ç›® å®Œäº†æ•°/ç·æ•°ï¼ˆxx%ï¼‰`
- Todoï¼š`Todo å®Œäº†æ•°/ç·æ•°ï¼ˆxx%ï¼‰`

ã“ã‚Œã«ã‚ˆã‚Šã€ã€Œã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ Phase ãŒä½•å€‹ã‚ã£ã¦ã€ãã®ã†ã¡ä½•å€‹ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‹ã€ã€ŒTodo ãƒ™ãƒ¼ã‚¹ã§ã¯ã©ã‚Œãã‚‰ã„çµ‚ã‚ã£ã¦ã„ã‚‹ã‹ã€ã‚’ä¸€ç›®ã§ç¢ºèªã§ãã¾ã™ã€‚

### 12.2 ã‚µãƒ¼ãƒãƒ¼å´ã§ä½•ã‚’è¨ˆç®—ã—ã¦ã„ã‚‹ã‹

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`server/src/infrastructure/repositories/projectRepository.ts`

`getTodoStats` ã«åŠ ãˆã¦ã€`getPlanningStats` ã¨ã„ã†é–¢æ•°ã§ Phase/Work/Task ã®ä»¶æ•°ã‚’é›†è¨ˆã—ã¦ã„ã¾ã™ã€‚

```ts
getPlanningStats(projectId: string) {
  const phaseRes = db
    .prepare(
      `SELECT
         SUM(CASE WHEN status = 'DONE' THEN 1 ELSE 0 END) AS done,
         COUNT(id) AS total
       FROM phases
       WHERE projectId = ?`,
    )
    .get(projectId) as { done: number | null; total: number | null };

  // works / tasks ã‚‚åŒæ§˜ã«é›†è¨ˆ

  return {
    phases: { done: phaseRes.done ?? 0, total: phaseRes.total ?? 0 },
    works: { ... },
    tasks: { ... },
  };
}
```

ã“ã®é–¢æ•°ã¯ã€å„ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ`phases`, `works`, `tasks`ï¼‰ã”ã¨ã«

- `status = 'DONE'` ã®ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° â†’ `done`
- å…¨ãƒ¬ã‚³ãƒ¼ãƒ‰æ•° â†’ `total`

ã‚’é›†è¨ˆã—ã¦è¿”ã—ã¾ã™ã€‚

`projectService.listProjects()` ã§ã¯ã€ã“ã‚Œã‚’ä½¿ã£ã¦ `ProjectSummary` ã«æƒ…å ±ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`server/src/application/projectService.ts`

```ts
listProjects(): ProjectSummary[] {
  const projects = projectRepository.list();
  return projects.map((project) => {
    const stats = projectRepository.getTodoStats(project.id);
    const planningStats = projectRepository.getPlanningStats(project.id);
    const progress = calculateProjectProgress(project.id);
    return {
      ...project,
      progress,
      todoCounts: { total: stats.total, done: stats.done },
      phaseCounts: { total: planningStats.phases.total, done: planningStats.phases.done },
      workCounts: { total: planningStats.works.total, done: planningStats.works.done },
      taskCounts: { total: planningStats.tasks.total, done: planningStats.tasks.done },
    };
  });
}
```

`ProjectSummary` å‹ï¼ˆ`server/src/domain/entities.ts`ï¼‰ã«ã‚‚ã€å¯¾å¿œã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

```ts
export interface ProjectSummary extends Project {
  progress: number;
  todoCounts: { total: number; done: number };
  phaseCounts: { total: number; done: number };
  workCounts: { total: number; done: number };
  taskCounts: { total: number; done: number };
}
```

### 12.3 ãƒ•ãƒ­ãƒ³ãƒˆå´ã§ã®è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`web/src/types.ts`

ã‚µãƒ¼ãƒãƒ¼å´ã¨åŒã˜å½¢ã§ `ProjectSummary` ã« `phaseCounts`, `workCounts`, `taskCounts` ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`web/src/App.tsx`

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ã® JSX ã§ã€æ¸¡ã•ã‚ŒãŸä»¶æ•°ã‚’è¡¨ç¤ºã—ã¤ã¤ã€ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸ã‚’ãƒ•ãƒ­ãƒ³ãƒˆå´ã§è¨ˆç®—ã—ã¦ã„ã¾ã™ã€‚

```tsx
function calcPercent(done: number, total: number): number {
  if (!total) return 0;
  return Math.round((done / total) * 100);
}

<header className="project-header">
  <div>
    <h1>{currentProject.name}</h1>
    <p>{currentProject.description}</p>
  </div>
  <div className="project-stat">
    <span>å…¨ä½“ {currentProject.progress}%</span>
    <small>
      å¤§é …ç›® {currentProject.phaseCounts.done}/{currentProject.phaseCounts.total}ï¼ˆ
      {calcPercent(currentProject.phaseCounts.done, currentProject.phaseCounts.total)}%ï¼‰
    </small>
    <small>
      ä¸­é …ç›® {currentProject.workCounts.done}/{currentProject.workCounts.total}ï¼ˆ
      {calcPercent(currentProject.workCounts.done, currentProject.workCounts.total)}%ï¼‰
    </small>
    <small>
      å°é …ç›® {currentProject.taskCounts.done}/{currentProject.taskCounts.total}ï¼ˆ
      {calcPercent(currentProject.taskCounts.done, currentProject.taskCounts.total)}%ï¼‰
    </small>
    <small>
      Todo {currentProject.todoCounts.done}/{currentProject.todoCounts.total}ï¼ˆ
      {calcPercent(currentProject.todoCounts.done, currentProject.todoCounts.total)}%ï¼‰
    </small>
 </div>
</header>
```

ã“ã“ã§ã®ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸è¨ˆç®—ã¯

```ts
é€²æ—(%) = (å®Œäº†æ•° / ç·æ•°) Ã— 100 ã‚’å››æ¨äº”å…¥
```

ã¨ã„ã†ã€è¦ä»¶å®šç¾©æ›¸ã«ã‚ã‚‹ã€Œå®Œäº†æ•° / ç·æ•° ãƒ™ãƒ¼ã‚¹ã®é€²æ—ã€ã¨åŒã˜è€ƒãˆæ–¹ã«ãªã£ã¦ã„ã¾ã™ã€‚

---

## 13. è¶…ã–ã£ãã‚Š API / DB / React å…¥é–€

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§ã¯ã€ã€ŒAPI ã¨ã‹ DB ã¨ã‹ React ã¨ã‹ã€è¨€è‘‰ã¯èã„ãŸã“ã¨ã‚ã‚‹ã‘ã©ã‚ˆãåˆ†ã‹ã‚‰ãªã„ã€ã¨ã„ã†å‰æã§ã€**ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å‡ºã¦ãã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã ã‘ã‚’è¶…ã–ã£ãã‚Šæ•´ç†**ã—ã¾ã™ã€‚

### 13.1 APIï¼ˆã‚¨ãƒ¼ãƒ”ãƒ¼ã‚¢ã‚¤ï¼‰ã¨ã¯ï¼Ÿ

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆã‚µãƒ¼ãƒãƒ¼ï¼‰ãŒã€ŒHTTP ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ã§ä¼šè©±ã€ã—ã¦ã„ã¾ã™ã€‚  
ãã®ã€Œä¼šè©±ã®æ±ºã¾ã‚Šã”ã¨ã€ãŒ **API** ã§ã™ã€‚

- ãƒ•ãƒ­ãƒ³ãƒˆï¼ˆ`web/`ï¼‰ã‹ã‚‰è¦‹ã‚‹ã¨
  - ã€Œ`/api/projects` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚‰ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ãŒ JSON ã§è¿”ã£ã¦ãã‚‹ã€ã¨ã„ã†ã€Œç´„æŸã”ã¨ã€
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ`server/`ï¼‰ã‹ã‚‰è¦‹ã‚‹ã¨
  - ã€Œ`GET /api/projects` ãŒæ¥ãŸã‚‰ã€ã“ã®é–¢æ•°ã‚’å‘¼ã‚“ã§çµæœã‚’è¿”ã™ã€ã¨ã„ã†ã€Œå…¥å£ã€

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€API ã¯æ¬¡ã®ã‚ˆã†ã«ä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚

- `web/src/api.ts` â€¦ ãƒ•ãƒ­ãƒ³ãƒˆå´ã‹ã‚‰è¦‹ãŸã€ŒAPI ã®å…¥ã‚Šå£ã€
  - ä¾‹ï¼š`fetchProjects()` â†’ `GET /api/projects`
  - ä¾‹ï¼š`fetchHierarchy(projectId)` â†’ `GET /api/projects/:projectId/hierarchy`
  - ä¾‹ï¼š`patchEntity('todos', id, patch)` â†’ `PATCH /api/todos/:id`
- `server/src/presentation/server.ts` â€¦ ã‚µãƒ¼ãƒãƒ¼å´ã§ã€ŒURL ã”ã¨ã«ã©ã®å‡¦ç†ã‚’å‘¼ã¶ã‹ã€ã‚’å®šç¾©
  - ä¾‹ï¼š`app.get('/api/projects', ...)`
  - ä¾‹ï¼š`app.patch('/api/todos/:id', ...)`

ã¤ã¾ã‚Šã€

- ãƒ•ãƒ­ãƒ³ãƒˆã¯ `api.ts` çµŒç”±ã§ã€Œã‚µãƒ¼ãƒãƒ¼ã«ãŠé¡˜ã„ã‚’å‡ºã™ã€
- ã‚µãƒ¼ãƒãƒ¼ã¯ `server.ts` ã§ã€Œã©ã®ãŠé¡˜ã„ã‚’ã©ã†å‡¦ç†ã™ã‚‹ã‹ã€ã‚’æ±ºã‚ã¦ã„ã‚‹

ã¨ã„ã†é–¢ä¿‚ã«ãªã£ã¦ã„ã¾ã™ã€‚

### 13.2 Databaseï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ã¨ã¯ï¼Ÿ

ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆDBï¼‰ã¯ã€ã€Œã‚¢ãƒ—ãƒªã®çŠ¶æ…‹ã‚’ä¿å­˜ã—ã¦ãŠãå ´æ‰€ã€ã§ã™ã€‚  
ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ **SQLite** ã¨ã„ã†è»½é‡ãª DB ã‚’ä½¿ã£ã¦ã„ã¦ã€å®Ÿä½“ã¯ `server/var/app.db` ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼š

- Excel ã®ã‚·ãƒ¼ãƒˆãŒãŸãã•ã‚“ä¸¦ã‚“ã§ã„ã‚‹æ„Ÿã˜
  - `projects` ã‚·ãƒ¼ãƒˆ
  - `phases` ã‚·ãƒ¼ãƒˆ
  - `works` ã‚·ãƒ¼ãƒˆ
  - `tasks` ã‚·ãƒ¼ãƒˆ
  - `todos` ã‚·ãƒ¼ãƒˆ
- ãã‚Œãã‚Œã®ã‚·ãƒ¼ãƒˆã«è¡ŒãŒå¢—ãˆã¦ã„ãã€1 è¡ŒãŒ 1 ãƒ¬ã‚³ãƒ¼ãƒ‰ï¼ˆ1 ä»¶ã®ãƒ‡ãƒ¼ã‚¿ï¼‰ã«ãªã‚‹

ã‚³ãƒ¼ãƒ‰ä¸Šã§ã¯ã€

- `server/src/infrastructure/db.ts` â€¦ DB ã«æ¥ç¶šã™ã‚‹éƒ¨åˆ†
- `server/src/infrastructure/migrations.ts` â€¦ ã€Œ`projects` ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’ä½œã‚‹ã€ãªã©ã€è¡¨ã®å®šç¾©
- `server/src/infrastructure/repositories/*.ts` â€¦ ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’å–ã‚‹ã€ã€ŒTodo ã‚’æ›´æ–°ã™ã‚‹ã€ãªã©ã€DB ã«å¯¾ã™ã‚‹æ“ä½œã‚’ã¾ã¨ã‚ãŸå±¤

ã¨ã„ã†åˆ†æ‹…ã«ãªã£ã¦ã„ã¾ã™ã€‚

ãƒ•ãƒ­ãƒ³ãƒˆã‹ã‚‰è¦‹ã‚‹ã¨ã€

1. `api.ts` ãŒ HTTP ã§ã‚µãƒ¼ãƒãƒ¼ã«ãŠé¡˜ã„ã™ã‚‹
2. `server.ts` ã‹ã‚‰ `projectService` / Repository ãŒå‘¼ã°ã‚Œã‚‹
3. Repository ãŒ DB ã‚’æ“ä½œã™ã‚‹

ã¨ã„ã† 3 æ®µéšæ§‹é€ ã«ãªã£ã¦ã„ã‚‹ã€ã¨ã„ã†ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæŒã¦ã‚Œã°ååˆ†ã§ã™ã€‚

### 13.3 React ã¨ã¯ï¼Ÿï¼ˆã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§å‡ºã¦ãã‚‹ç¯„å›²ï¼‰

React ã¯ã€ŒUI ã‚’éƒ¨å“(ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)ã«åˆ†ã‘ã¦çµ„ã¿ç«‹ã¦ã¦ã„ããŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ã§ã™ã€‚

#### ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ã‚¤ãƒ¡ãƒ¼ã‚¸

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ã–ã£ãã‚Šæ¬¡ã®ã‚ˆã†ãªæ§‹é€ ã«ãªã£ã¦ã„ã¾ã™ã€‚

- `App.tsx` â€¦ ç”»é¢å…¨ä½“ã®ã€Œå¸ä»¤å¡”ã€
  - å·¦ï¼š`ProjectSidebar`ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ï¼‰
  - ä¸­å¤®ï¼š`HierarchyView`ï¼ˆå¤§ãƒ»ä¸­ãƒ»å°ãƒ»Todo ã®éšå±¤ï¼‰
  - å³ï¼š`TodayPanel`ï¼ˆä»Šæ—¥ã® Todoï¼‰

React ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€ã€Œé–¢æ•°ã¨ã—ã¦ UI ã‚’è¿”ã™ã‚‚ã®ã€ã¨è€ƒãˆã‚‹ã¨åˆ†ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚

```tsx
function TodayPanel(props: { todos: Todo[] }) {
  // props.todos ã‚’ã‚‚ã¨ã«ç”»é¢ã‚’çµ„ã¿ç«‹ã¦ã‚‹
  return <div>...</div>;
}
```

- `props` â€¦ è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰æ¸¡ã•ã‚Œã‚‹ã€Œå¼•æ•°ã€ã®ã‚ˆã†ãªã‚‚ã®
- `state` â€¦ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…éƒ¨ã§æŒã¤ã€ŒçŠ¶æ…‹ã€ï¼ˆ`useState` ã§å®šç¾©ï¼‰

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€

- ã€Œãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã‚„æ›´æ–°ã€ã¯åŸºæœ¬çš„ã« `App.tsx` ãŒè¡Œã„
- `HierarchyView` ã‚„ `TodayPanel` ã«ã¯ã€Œè¡¨ç¤ºç”¨ã®ãƒ‡ãƒ¼ã‚¿ã€ã¨ã€Œæ›´æ–°ç”¨ã®é–¢æ•°ï¼ˆonUpdate ãªã©ï¼‰ã€ã‚’æ¸¡ã™

ã¨ã„ã†ã‚¹ã‚¿ã‚¤ãƒ«ã«ãªã£ã¦ã„ã¾ã™ã€‚

#### React ã¨ã“ã®ã‚¢ãƒ—ãƒªã®é–¢ä¿‚ã‚’ 1 æ–‡ã§è¨€ã†ã¨

> ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–ã£ã¦ããŸ Project / Phase / Work / Task / Todo ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã€  
> Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ã£ã¦ã€Œã„ã„æ„Ÿã˜ã®ç”»é¢ã€ã«ä¸¦ã¹ã¦ã„ã‚‹

ã ã‘ã ã¨æ€ã£ã¦ã‚‚ã‚‰ãˆã‚Œã°OKã§ã™ã€‚

---

## 14. ã€Œã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒã©ã†å‹•ã„ã¦ã„ã‚‹ã‹ã€ã‚’ä¸€æ°—ã«çœºã‚ã‚‹

æœ€å¾Œã«ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®æµã‚Œã‚’ **ã€Œãƒ•ãƒ­ãƒ³ãƒˆ â†’ API â†’ ã‚µãƒ¼ãƒãƒ¼ â†’ DB â†’ é€²æ—è¨ˆç®— â†’ ãƒ•ãƒ­ãƒ³ãƒˆã€** ã¨ã„ã†ä¸€æœ¬ã®ç·šã§ã¾ã¨ã‚ã¾ã™ã€‚

### 14.1 å…¸å‹çš„ãªãƒ•ãƒ­ãƒ¼ï¼šTodo ã‚’ 1 ä»¶è¿½åŠ ã™ã‚‹

1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ UI ä¸Šã§ã€Œï¼‹ Todoã€ã‚’æŠ¼ã™  
   - ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`web/src/components/HierarchyView.tsx` ã® `AddTodoButton`
2. `AddTodoButton` ãŒ `onSubmit` çµŒç”±ã§ `HierarchyView` ã«ã€Œã“ã® Task ã« Todo ã‚’è¿½åŠ ã—ã¦ã€ã¨é€šçŸ¥
3. `HierarchyView` ã¯ `props.onAddTodo(taskId, payload)` ã‚’å‘¼ã¶
4. `App.tsx` ã§ã¯ã€ãã® `onAddTodo` ãŒ
   - `mutate(() => api.createTodo(...), true)`
   ã«ãªã£ã¦ã„ã‚‹ã®ã§ã€`api.createTodo` ã‚’å‘¼ã³å‡ºã™
5. `api.createTodo` ãŒ `POST /api/projects/:projectId/todos` ã« HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹
6. ã‚µãƒ¼ãƒãƒ¼å´ã® `server.ts` ã§
   - `app.post('/api/projects/:projectId/todos', ...)` ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚‹
7. Zod ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ‡ã‚£ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã‚ã¨ã€`projectService.createTodo` ã‚’å‘¼ã¶
8. `projectService.createTodo` ãŒ Repository ã‚’é€šã˜ã¦
   - `todos` ãƒ†ãƒ¼ãƒ–ãƒ«ã« 1 è¡Œ INSERT ã™ã‚‹
9. æˆåŠŸã—ãŸã‚‰ HTTP ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™
10. ãƒ•ãƒ­ãƒ³ãƒˆå´ã® `mutate` ãŒç¶šãã§
    - `refreshHierarchy`ï¼ˆéšå±¤ãƒ‡ãƒ¼ã‚¿ã‚’å†å–å¾—ï¼‰
    - `refreshTodayTodos`ï¼ˆä»Šæ—¥ã® Todo ã‚’å†å–å¾—ï¼‰
    - `loadProjects`ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã‚’å†å–å¾—ï¼‰
    ã‚’è¡Œã†
11. React ã® `setState` ã«ã‚ˆã£ã¦ç”»é¢ãŒå†æç”»ã•ã‚Œã‚‹

â†’ ã“ã†ã—ã¦ã€ã€ŒTodo ã‚’ 1 ä»¶è¿½åŠ ã—ãŸã€ã¨ã„ã†æ“ä½œãŒ DB ã«ä¿å­˜ã•ã‚Œã€ç”»é¢ã«åæ˜ ã•ã‚Œã¾ã™ã€‚

### 14.2 å…¸å‹çš„ãªãƒ•ãƒ­ãƒ¼ï¼šä¸­é …ç›®/å°é …ç›®/Todo ã®è¡¨ç¤ºã‚’æŠ˜ã‚ŠãŸãŸã‚€

ã‚ãªãŸãŒä»Šå›ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸã€Œä¸­é …ç›®ãƒ»å°é …ç›®ãƒ»Todo ã®æŠ˜ã‚ŠãŸãŸã¿ã€ã¯ã€**ã‚µãƒ¼ãƒãƒ¼ã‚„ DB ã«ã¯ä¸€åˆ‡å½±éŸ¿ã—ãªã„ã€Œè¡¨ç¤ºã ã‘ã®å·¥å¤«ã€** ã§ã™ã€‚

- ãƒ•ã‚¡ã‚¤ãƒ«ï¼š`web/src/components/HierarchyView.tsx`
  - `PhaseCard` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ â€¦ ä¸­é …ç›®ï¼ˆWork ä¸€è¦§ï¼‰ã®æŠ˜ã‚ŠãŸãŸã¿
  - `WorkRow` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ â€¦ å°é …ç›®ï¼ˆTask ä¸€è¦§ï¼‰ã®æŠ˜ã‚ŠãŸãŸã¿
  - `TaskRow` ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ â€¦ Todo ä¸€è¦§ã®æŠ˜ã‚ŠãŸãŸã¿

ãã‚Œãã‚Œã§ `useState` ã‚’ä½¿ã£ã¦ã€

- `showWorks` / `showTasks` / `showTodos` ã¨ã„ã†ã€Œè¡¨ç¤ºãƒ•ãƒ©ã‚°ã€ã‚’æŒã¡
- ã€Œâ–½ / â–¶ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã« true/false ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹
- `true` ã®ã¨ãã ã‘ `.map(...)` ã§å­è¦ç´ ã‚’æç”»ã™ã‚‹

ã¨ã„ã†ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ­ã‚¸ãƒƒã‚¯ã«ãªã£ã¦ã„ã¾ã™ã€‚

ãƒã‚¤ãƒ³ãƒˆï¼š

- DB ã®æ§‹é€ ã‚„ API ã¯ãã®ã¾ã¾
- ç”»é¢å´ã§ã€Œã©ã“ã¾ã§å±•é–‹ã—ã¦è¦‹ã›ã‚‹ã‹ã€ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã—ã¦ã„ã‚‹ã ã‘

ãªã®ã§ã€ã€ŒUI ã®æ”¹å–„ã¯ãƒ•ãƒ­ãƒ³ãƒˆã ã‘ã§å®Œçµã™ã‚‹è‰¯ã„ä¾‹ã€ã¨ã—ã¦ã€ã“ã®å¤‰æ›´ç®‡æ‰€ã‚’è¦‹è¿”ã™ã¨ç†è§£ãŒæ·±ã¾ã‚Šã¾ã™ã€‚

### 14.3 ã€Œç†è§£ã§ããŸã‹ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã€

æ¬¡ã®è³ªå•ã«ã–ã£ãã‚Šç­”ãˆã‚‰ã‚Œã‚Œã°ã€ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å…¨ä½“åƒã¯ã‹ãªã‚Šè¦‹ãˆã¦ã„ã¾ã™ã€‚

- Q1: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã¯ã©ã® API ã§å–ã£ã¦ãã¦ã€ã©ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§è¡¨ç¤ºã—ã¦ã„ã¾ã™ã‹ï¼Ÿ
- Q2: Todo ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’å¤‰ãˆãŸã¨ãã€ã©ã®é †ç•ªã§ã‚µãƒ¼ãƒãƒ¼ãƒ»DBãƒ»é€²æ—è¨ˆç®—ãŒå‹•ãã¾ã™ã‹ï¼Ÿ
- Q3: Phase / Work / Task / Todo ã® 4 éšå±¤ã¯ã€DB ä¸Šã§ã¯ã©ã‚“ãªãƒ†ãƒ¼ãƒ–ãƒ«ã«åˆ†ã‹ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ
- Q4: ã€ŒæŠ˜ã‚ŠãŸãŸã¿ã€æ©Ÿèƒ½ã¯ã€ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ã©ã® state ã§åˆ¶å¾¡ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ

ã‚‚ã—ã©ã‚Œã‹ãŒã‚ã„ã¾ã„ã§ã‚‚ã€ä¸Šã®è©²å½“ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’èª­ã¿è¿”ã›ã°ç­”ãˆãŒè¦‹ã¤ã‹ã‚‹ã‚ˆã†ã«æ§‹æˆã—ã¦ã‚ã‚Šã¾ã™ã€‚  
ã‚ã‹ã‚‰ãªã„ã¨ã“ã‚ãŒã‚ã‚Œã°ã€ãã“ã ã‘ã‚’ãƒ”ãƒ³ãƒã‚¤ãƒ³ãƒˆã§èã„ã¦ã‚‚ã‚‰ã£ã¦ã‚‚å¤§ä¸ˆå¤«ã§ã™ã€‚
